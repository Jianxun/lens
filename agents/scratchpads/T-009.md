# T-009 — Frontend MVP

## Task summary
- DoD:
  - Implement chat UI (markdown assistant, user bubbles), session list panel, streaming `/chat` consumption, collapsible histogram display with cited turn_ids.
  - Send full history by default to `/chat`.
- Verify:
  - UI shows sessions, loads history, streams replies; histogram panel renders when provided.

## Read
- `agents/context/lessons.md`
- `agents/context/contract.md`
- `agents/context/tasks.md`
- `agents/context/handoff.md`
- `backend/api/chat.py`
- `backend/api/retrieval.py`
- `backend/api/sessions.py`
- `backend/main.py`
- `backend/services/agent.py` (streaming format)
- `frontend/` (Vite scaffold, src/app/api/types/css)

## Plan
1. Review backend chat/retrieval/session APIs and any existing frontend scaffold.
2. Design minimal frontend structure (routing, state, API client) to consume `/sessions`, `/chat`, `/retrieval`.
3. Implement chat UI with streaming handling, markdown rendering, and session history loading.
4. Add histogram panel with cited turn_ids, collapsible.
5. Smoke test locally (frontend dev server) and document steps.

## Progress log
- 2025-12-25: Read lessons/contract/tasks/handoff. Created branch `feature/T-009-frontend-mvp`. Added scratchpad and set T-009 to In Progress in tasks.md.
- 2025-12-25: Listed backend endpoints (chat/retrieval/sessions), inspected streaming shape (OpenAI-style SSE with metadata chunk). Noted `frontend/` directory does not exist yet.
- 2025-12-25: Scaffolded Vite React TS app in `frontend/` with dev proxy `/api` → FastAPI. Added API helper for sessions + streaming chat (SSE parsing), shared types.
- 2025-12-25: Built chat UI (session list panel, chat transcript with markdown for assistants, composer sending full history + optional session_id, histogram/cited turn_ids panel). Styling refreshed for two-column layout. Added .gitignore entries for frontend artifacts and updated codebase_map.
- 2025-12-25: Installed frontend deps (`react-markdown`, `remark-gfm`), ran `npm run build` (pass).
- 2025-12-25: Fixed FastAPI 204 assertion by setting `response_class=Response` and explicit return for `/sessions/{session_id}` delete; `python - <<'PY' ... create_app` now succeeds.

## Patch summary
- `.gitignore`: ignore frontend build artifacts.
- `agents/context/codebase_map.md`: map frontend structure and proxy note.
- `frontend/`: new Vite React TS app (`src/App.tsx`, `src/api.ts`, `src/types.ts`, styles, config).
- `backend/api/sessions.py`: adjust delete route to use Response for 204.

## Verification
- `cd frontend && npm run build` (pass)
- `cd frontend && npm run build` (pass, 2025-12-25 post-backend fix)

## Blockers / Questions
- Pending

## Next steps
- Optional: manual smoke via `npm run dev` (frontend) with backend on :8000 and `.env` loaded for chat.
- Wire any additional retrieval UI if needed beyond histogram metadata.
- Confirm backend stays up (uvicorn) and frontend 404 resolves with proxy to `/api`.
# T-009 — Frontend MVP
## Context
- ChatGPT-like UI: left sessions list, main chat thread, markdown assistant bubbles.
- Streaming `/chat`; send full history by default.
- Show retrieval histogram in collapsible panel; keep cited turn_ids available.

## Scope / Allowed files
- `frontend/` (new; e.g., Vite/React)
- Minimal config; no heavy theming.

## Requirements
- Sessions list (title, updated_at, pinned/archived hidden) via `/sessions`.
- Load history via `/sessions/{id}`; render bubbles (user right, assistant left, markdown).
- Composer with send + Shift+Enter for newline.
- Streaming consumption of `/chat`; append tokens live.
- Display collapsible histogram (from `/chat` response metadata) and optionally cited turn_ids.
- Full history sent by default; no client truncation.

## DoD
- UI shows sessions, loads history, streams replies; histogram panel renders when provided.

