# T-004 â€” Database schema & migrations
## Context
- Implement Postgres schema per ADRs (0001, 0002, 0003, 0004, 0005, 0006).
- Tables: conversations, messages, message_embeddings (UUID PK), sessions, session_messages, ingest_runs.
- Constraints: roles (user/assistant), idx ordering, uniqueness, truncation rules.

## Scope / Allowed files
- `migrations/` (new SQL files)
- `README.md` (DB setup notes)

## Decisions / Notes
- Fixed embedding model `text-embedding-3-large` (no provider/model knobs in schema).
- messages must store turn_summary, content_text (with truncation guard), raw, timestamps.
- message_embeddings: UUID PK, user_message_id anchor, assistant_message_id, content_used, used_turn_summary, content_hash opt, vector.
- sessions: linear, one session per message, no superseded drafts stored.
- session_messages: unique(session_id, message_id), idx for order.
- ingest_runs for observability.

## DoD
- Migration applies cleanly on fresh DB.
- \dt shows expected tables.
- Constraints present (role check, uniqueness).

